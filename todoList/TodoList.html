<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    
    <title>Todo-VanilaJS</title>
</head>
<body>
    <header id="headeWrap">
        <button class="darkMode"><span>ğŸŒ™</span></button>
    </header>
    <div class="todo-wrapper">
        <div class="todo-title">ğŸ™‹ğŸ¼â€â™€ï¸ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸!</div>
        <div class="todo-box">

            <div class="todo-input-box">
                <button class="complete-all-btn">âœ”</button>
                <input type="text" class="todo-input" placeholder="í•´ì•¼ í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
            </div>
            
            <ul class="todo-list">
            <li class="todo-item checked">
            </ul>
            <div class="todo-bottom">
                <div class="left-items">3 items left</div>
                <div class="button-group">
                    <button class="show-all-btn selected" data-type="all">All</button>
                    <button class="show-active-btn" data-type="active">Active</button>
                    <button class="show-completed-btn" data-type="completed">Completed</button>
                </div>
                <button class="clear-completed-btn">Clear Completed</button>
            </div>
        </div>
        <p class='info'>ë”ë¸”í´ë¦­ ì‹œ ìˆ˜ì • ê°€ëŠ¥!</p>
       
    </div>

    
    <!-- <script src="todo.js" ></script> -->
    <script>
    const todoInputElem = document.querySelector('.todo-input');
    const todoListElem = document.querySelector('.todo-list');
    const completeAllBtnElem = document.querySelector('.complete-all-btn');

    const leftItemsElem = document.querySelector('.left-items')

    const getActiveTodos = () => {
        return todos.filter(todo => todo.isCompleted === false);
    }

    const setLeftItems = () => {
        const leftTodos = getActiveTodos()
        leftItemsElem.innerHTML = `${leftTodos.length} items left`
    }

    let todos = [];
    let id = 0;

    const setTodos = (newTodos) => {
        todos = newTodos;
    }

    const getAllTodos = () => {
        return todos;
    }

    const getCompletedTodos = () => {
        return todos.filter(todo => todo.isCompleted === true );
    }

    let isAllCompleted = ''; // ì „ì²´ todos ì²´í¬ ì—¬ë¶€

    const setIsAllCompleted = (bool) => { isAllCompleted = bool};

    const completeAll = () => {
        completeAllBtnElem.classList.add('checked');
        const newTodos = getAllTodos().map(todo => ({...todo, isCompleted: true }) )
        setTodos(newTodos)
    }

    const incompleteAll = () => {
        completeAllBtnElem.classList.remove('checked');
        const newTodos =  getAllTodos().map(todo => ({...todo, isCompleted: false }) );
        setTodos(newTodos)
    }

    // ì „ì²´ todosì˜ check ì—¬ë¶€ (isCompleted)
    const checkIsAllCompleted = () => {
        if(getAllTodos().length === getCompletedTodos().length ){
            setIsAllCompleted(true);
            completeAllBtnElem.classList.add('checked');
        }else {
            setIsAllCompleted(false);
            completeAllBtnElem.classList.remove('checked');
        }
    }

    const onClickCompleteAll = () => {
        if(!getAllTodos().length) return; // todosë°°ì—´ì˜ ê¸¸ì´ê°€ 0ì´ë©´ return;

        if(isAllCompleted) incompleteAll(); // isAllCompletedê°€ trueì´ë©´ todosë¥¼ ì „ì²´ ë¯¸ì™„ë£Œ ì²˜ë¦¬ 
        else completeAll(); // isAllCompletedê°€ falseì´ë©´ todosë¥¼ ì „ì²´ ì™„ë£Œ ì²˜ë¦¬ 
        setIsAllCompleted(!isAllCompleted); // isAllCompleted í† ê¸€
        paintTodos(); // ìƒˆë¡œìš´ todosë¥¼ ë Œë”ë§
        setLeftItems()
    }

    const appendTodos = (text) => {
        const newId = id++;
        const newTodos = getAllTodos().concat({id: newId, isCompleted: false, content: text })
        // const newTodos = [...getAllTodos(), {id: newId, isCompleted: false, content: text }]
        setTodos(newTodos)
        setLeftItems()
        checkIsAllCompleted();
        paintTodos();
    }

    const deleteTodo = (todoId) => {
        const newTodos = getAllTodos().filter(todo => todo.id !== todoId );
        setTodos(newTodos);
        setLeftItems()
        paintTodos()
    }

    const completeTodo = (todoId) => {
        const newTodos = getAllTodos().map(todo => todo.id === todoId ? {...todo,  isCompleted: !todo.isCompleted} : todo )
        setTodos(newTodos);
        paintTodos();
        setLeftItems()
        checkIsAllCompleted();
    }

    const updateTodo = (text, todoId) => {
        const currentTodos = getAllTodos();
        const newTodos = currentTodos.map(todo => todo.id === todoId ? ({...todo, content: text}) : todo);
        setTodos(newTodos);
        paintTodos();
    }

    const onDbclickTodo = (e, todoId) => {
        const todoElem = e.target;
        const inputText = e.target.innerText;
        const todoItemElem = todoElem.parentNode;
        const inputElem = document.createElement('input');
        inputElem.value = inputText;
        inputElem.classList.add('edit-input');
        inputElem.addEventListener('keypress', (e)=>{
            if(e.key === 'Enter') {
                updateTodo(e.target.value, todoId);
                document.body.removeEventListener('click', onClickBody );
            }
        })

        const onClickBody = (e) => {
            if(e.target !== inputElem)  {
                todoItemElem.removeChild(inputElem);
                document.body.removeEventListener('click', onClickBody );
            }
        }
        
        document.body.addEventListener('click', onClickBody)
        todoItemElem.appendChild(inputElem);
    }

    const paintTodos = () => {
        todoListElem.innerHTML = null; //todoListElem ìš”ì†Œ ì•ˆì˜ HTML ì´ˆê¸°í™”
        const allTodos = getAllTodos() // todos ë°°ì—´ ê°€ì ¸ì˜¤ê¸°

        allTodos.forEach(todo => { 
            const todoItemElem = document.createElement('li');
            todoItemElem.classList.add('todo-item');

            todoItemElem.setAttribute('data-id', todo.id );

            const checkboxElem = document.createElement('div');
            checkboxElem.classList.add('checkbox');
            checkboxElem.addEventListener('click', () => completeTodo(todo.id))
        
            const todoElem = document.createElement('div');
            todoElem.classList.add('todo');
            todoElem.addEventListener('dblclick', (event) => onDbclickTodo(event, todo.id))
            todoElem.innerText = todo.content;
        
            const delBtnElem = document.createElement('button');
            delBtnElem.classList.add('delBtn');
            delBtnElem.addEventListener('click', () =>  deleteTodo(todo.id))
            delBtnElem.innerHTML = 'X';

            if(todo.isCompleted) {
                todoItemElem.classList.add('checked');
                checkboxElem.innerText = 'âœ”';
            }

            todoItemElem.appendChild(checkboxElem);
            todoItemElem.appendChild(todoElem);
            todoItemElem.appendChild(delBtnElem);

            todoListElem.appendChild(todoItemElem);
        })
    }

    // ë¡œë“œë˜ë©´ ì´ˆê¸°í™”.
    const init = () => {
        todoInputElem.addEventListener('keypress', (e) =>{
            if( e.key === 'Enter' ){
                appendTodos(e.target.value); todoInputElem.value ='';
            }
        })

        completeAllBtnElem.addEventListener('click',  onClickCompleteAll)

        setLeftItems()
    }

    init()

    const bodyEl = document.querySelector("body");
    const darkMode = document.querySelector(".darkMode");
    const title = document.querySelector(".todo-title");
    const todobox = document.querySelector(".todo-box");

    // ì´ˆê¸° ìƒíƒœë¥¼ ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì„¤ì •
    let isDarkMode = false;

    darkMode.addEventListener('click', () => {
        if (!isDarkMode) {
            // ë‹¤í¬ ëª¨ë“œ í™œì„±í™”
            bodyEl.style.backgroundColor = "#000";
            bodyEl.style.color = "#fff";
            title.style.color = "#fff";
            isDarkMode = true; // ìƒíƒœ ì—…ë°ì´íŠ¸
        } else {
            // ë¼ì´íŠ¸ ëª¨ë“œ í™œì„±í™”
            bodyEl.style.backgroundColor = "#fff";
            bodyEl.style.color = "#000";
            title.style.color = "#000";
            isDarkMode = false; // ìƒíƒœ ì—…ë°ì´íŠ¸
        }
    });

    </script>
</body>
</html>